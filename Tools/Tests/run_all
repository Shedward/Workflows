#!/usr/bin/env bash
set -uo pipefail

readonly SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

readonly TEST_SCRIPTS=(
  run_test_workflow
  run_simple_git_workflow
  run_automatic_simple_git_workflow
)

readonly GREEN='\033[0;32m'
readonly RED='\033[0;31m'
readonly RESET='\033[0m'
readonly CLEAR_LINE='\033[2K'

failed=0

for script in "${TEST_SCRIPTS[@]}"; do
  printf '  %s\n' "${script}"
  printf '\033[1A'

  if output="$("${SCRIPT_DIR}/${script}" 2>&1)"; then
    printf '%b\r%b✔%b %s\n' "${CLEAR_LINE}" "${GREEN}" "${RESET}" "${script}"
  else
    printf '%b\r%b✘%b %s\n' "${CLEAR_LINE}" "${RED}" "${RESET}" "${script}"
    printf '%s\n' "${output}"
    failed=1
  fi
done

exit "${failed}"
