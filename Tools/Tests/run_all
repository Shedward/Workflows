#!/usr/bin/env bash
set -uo pipefail

readonly SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

readonly TEST_SCRIPTS=(
  run_test_workflow
  run_simple_git_workflow
  run_automatic_simple_git_workflow
)

readonly GREEN='\033[0;32m'
readonly RED='\033[0;31m'
readonly RESET='\033[0m'
readonly CLEAR_LINE='\033[2K'

failed=0

for script in "${TEST_SCRIPTS[@]}"; do
  printf "  %s\n" "${script}"
  printf '\033[1A'

  output="$("${SCRIPT_DIR}/${script}" 2>&1)"
  status=$?

  printf '%b\r' "${CLEAR_LINE}"

  if [[ ${status} -eq 0 ]]; then
    printf '%b✔%b %s\n' "${GREEN}" "${RESET}" "${script}"
  else
    printf '%b✘%b %s\n' "${RED}" "${RESET}" "${script}"
    printf '%s\n' "${output}"
    failed=1
  fi
done

exit "${failed}"
